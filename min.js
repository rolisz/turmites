(function(){function x(){this.m={}}function t(a){y=n=o=0;s=new x;var b=location.hash.substring(1);b==""&&(b='[[["1",1,"0"],["0",-1,"0"]]]');b=JSON.parse(b);J(b)?p=b:alert("bad rule");typeof a=="undefined"&&(a=!0);if(a)for(a=0;a<q;a++)for(b=0;b<r;b++)Math.floor(Math.random()*11)==0&&a>q/2-v&&a<q/2+v&&b>r/2-v&&b<r/2+v&&s.set(a,b,1);j={x:Math.floor(q/2),y:Math.floor(r/2),state:0,d:1};z()}function z(){e.clearRect(0,0,A,B);if(h>10){e.save();e.strokeStyle="grey";for(var a=0;a<q+1;a++)e.beginPath(),e.moveTo(a*
h,0),e.lineTo(a*h,(r+1)*h),e.closePath(),e.stroke();for(a=0;a<r+1;a++)e.beginPath(),e.moveTo(0,a*h),e.lineTo((q+1)*h,a*h),e.closePath(),e.stroke();e.strokeStyle="black";e.restore()}for(a=0;a<q;a++)for(var b=0;b<r;b++)if(s.get(a-n,b+o)!=0)e.fillStyle=K[s.get(a-n,b+o)],e.fillRect(a*h,b*h,h,h),e.fillStyle="black";if(j.x+n>0&&j.y-o>0)e.fillStyle="orange",e.fillRect((j.x+n)*h+1,(j.y-o)*h+1,h-2,h-2),e.fillStyle="black";a=p[j.state][s.get(j.x,j.y)];j.d+=a[1];s.set(j.x,j.y,a[0]);j.state=a[2];j.d<0&&(j.d+=
4);j.d%=4;switch(j.d){case 0:j.y--;break;case 1:j.x++;break;case 2:j.y++;break;case 3:j.x--}y++;k("step").innerHTML="Step: "+y}function w(){C=setInterval(z,L);k("start").disabled=!0}function D(){clearInterval(C);C=!1;k("start").disabled=!1}function J(a){for(var b=i=l=0,c=0,d=a.length;c<d;c++)if(Object.prototype.toString.call(a[c])==="[object Array]"){for(var m=i=0,f=a[c].length;m<f;m++)i++,b++;l++}else return!1;if(l*i!=b)return!1;c=0;for(d=a.length;c<d;c++){m=0;for(f=a[c].length;m<f;m++){if(a[c][m][0]<
0||a[c][m][0]>i)return!1;if(a[c][m][2]<0||a[c][m][2]>l)return!1}}return!0}function G(a){var b=document.getElementsByTagName("table")[0],c=b.childNodes[1].childNodes[0];c.childNodes[3].setAttribute("colspan",i*3);g=c.cells[c.cells.length-1].firstChild;g.addEventListener("click",M);for(c=b.childNodes[1].childNodes[2];c.hasChildNodes();)c.removeChild(c.firstChild);for(g=0;g<i;g++){var d=f("th");d.setAttribute("colspan",3);d.appendChild(document.createTextNode(g));c.appendChild(d)}c=b.childNodes[1].childNodes[4];
for(d=c.getElementsByTagName("td");d.length>i*3;)c.removeChild(d[d.length-1]);for(g=d.length;g<i*3;g++)d=f("td"),g%3==0&&d.appendChild(document.createTextNode("Write Color")),g%3==1&&d.appendChild(document.createTextNode("Turn direction")),g%3==2&&d.appendChild(document.createTextNode("Next ant state")),c.appendChild(d);for(c=b.rows;c.length>3;)b.deleteRow(c.length-1);for(g=0;g<l;g++){c=f("tr");d=f("td");g==0&&(d.appendChild(document.createTextNode("Ant States")),d.setAttribute("rowspan",l),c.appendChild(d),
d=f("td"));d.appendChild(document.createTextNode(g));c.appendChild(d);for(var m=0;m<i;m++){d=f("td");d.appendChild(document.createTextNode(a[g][m][0]));d.setAttribute("contenteditable","true");c.appendChild(d);var d=f("td"),e;switch(a[g][m][1]){case 0:e="A";break;case 1:e="R";break;case -1:e="L";break;case -2:e="B"}d.appendChild(document.createTextNode(e));d.setAttribute("contenteditable","true");c.appendChild(d);d=f("td");d.appendChild(document.createTextNode(a[g][m][2]));d.setAttribute("contenteditable",
"true");c.appendChild(d)}b.childNodes[1].appendChild(c)}var d=f("td"),g=f("button");g.appendChild(document.createTextNode("-"));g.addEventListener("click",E);d.appendChild(g);c=b.rows[b.rows.length-1];c.appendChild(d);c=f("tr");d=f("td");d.setAttribute("colspan",2);g=f("button");g.appendChild(document.createTextNode("+"));g.addEventListener("click",N);d.appendChild(g);c.appendChild(d);d=f("td");d.setAttribute("colspan",i*3-3);c.appendChild(d);d=f("td");d.setAttribute("colspan",3);g=f("button");g.appendChild(document.createTextNode("-"));
g.addEventListener("click",H);d.appendChild(g);c.appendChild(d);b.childNodes[1].appendChild(c)}function M(){var a=document.getElementsByTagName("table")[0],b=a.rows[0].cells[1];b.setAttribute("colspan",++i*3);var c=a.rows[1],b=f("th");b.setAttribute("colspan",3);b.appendChild(document.createTextNode(i-1));c.appendChild(b);c=a.rows[2];b=f("td");b.appendChild(document.createTextNode("Write Color"));c.appendChild(b);b=f("td");b.appendChild(document.createTextNode("Turn direction"));c.appendChild(b);
b=f("td");b.appendChild(document.createTextNode("Next ant state"));c.appendChild(b);for(var d=0;d<l;d++)for(var c=a.rows[d+3],e=0;e<3;e++)b=f("td"),b.setAttribute("contenteditable","true"),d<l-1?c.appendChild(b):c.insertBefore(b,c.lastChild);c=a.rows[a.rows.length-1];b=c.cells[1];b.setAttribute("colspan",i*3-3);i==2&&(b=f("td"),b.setAttribute("colspan",3),a=f("button"),a.appendChild(document.createTextNode("-")),a.addEventListener("click",H),b.appendChild(a),c.appendChild(b))}function N(){var a=document.getElementsByTagName("table")[0],
b=a.rows[3].cells[0];b.setAttribute("rowspan",++l);if(l>2){var c=a.rows[rows.length-2];c.removeChild(c.lastChild)}c=f("tr");b=f("td");b.appendChild(document.createTextNode(l-1));c.appendChild(b);for(var d=0;d<i;d++)b=f("td"),b.setAttribute("contenteditable","true"),c.appendChild(b),b=f("td"),b.setAttribute("contenteditable","true"),c.appendChild(b),b=f("td"),b.setAttribute("contenteditable","true"),c.appendChild(b);b=f("td");d=f("button");d.appendChild(document.createTextNode("-"));d.addEventListener("click",
E);b.appendChild(d);c.appendChild(b);a.childNodes[1].insertBefore(c,a.childNodes[1].lastChild)}function H(){var a=document.getElementsByTagName("table")[0],b=a.rows[0].cells[1];b.setAttribute("colspan",--i*3);var c=a.rows[1];c.removeChild(c.cells[c.cells.length-1]);c=a.rows[2];for(b=0;b<3;b++)c.removeChild(c.cells[c.cells.length-1]);for(var d=0;d<l;d++){c=a.rows[d+3];for(b=0;b<3;b++)d<l-1?c.removeChild(c.cells[c.cells.length-1]):c.removeChild(c.cells[c.cells.length-2])}c=a.rows[a.rows.length-1];i>
1?(b=c.cells[1],b.setAttribute("colspan",i*3-3)):(b=c.cells[2],c.removeChild(b))}function E(){var a=document.getElementsByTagName("table")[0],b=a.rows[3].cells[0];b.setAttribute("rowspan",--l);a.deleteRow(a.rows.length-2);if(l>1){var a=a.rows[a.rows.length-2],b=document.createElement("td"),c=f("button");c.appendChild(document.createTextNode("-"));c.addEventListener("click",E);b.appendChild(c);a.appendChild(b)}}function I(a){o=u.topY-Math.floor((a.clientY-u.startY)/h);n=u.leftX+Math.floor((a.clientX-
u.startX)/h)}function k(a){return document.getElementById(a)}function f(a){return document.createElement(a)}x.prototype.set=function(a,b,c){typeof this.m[a]=="undefined"&&(this.m[a]={});c==0&&delete this.m[a][b];this.m[a][b]=c};x.prototype.get=function(a,b){if(typeof this.m[a]=="undefined")return 0;if(typeof this.m[a][b]=="undefined")return 0;return this.m[a][b]};var C,o=0,n=0,e=k("tutorial");e.addEventListener("mousedown",function(a){k("tutorial").addEventListener("mousemove",I,!1);u={startX:a.clientX,
startY:a.clientY,topY:o,leftX:n};F=setTimeout(function(){F=!1},300)},!1);e.addEventListener("mouseup",function(a){k("tutorial").removeEventListener("mousemove",I,!1);if(F){var b=k("tutorial"),c=Math.floor((a.clientX-b.offsetLeft)/h),a=Math.floor((a.clientY-b.offsetTop)/h),b=s.get(c-n,a+o);b++;b%=i;s.set(c-n,a+o,b)}},!1);e.addEventListener("mousewheel",function(a){var b;a.wheelDelta?b=a.wheelDelta/60:a.detail&&(b=-a.detail/2);h+b>=1&&h+b<50&&(h+=b);q=Math.floor(A/h);r=Math.floor(B/h);return!1},!1);
var F=!1,A=e.width=window.innerWidth-30,B=e.height=window.innerHeight-70,h=15,q=Math.floor(e.width/h),r=Math.floor(e.height/h),v=10,e=e.getContext("2d"),j,s,L=20,y=0,u={},p=[],l,i,K=["white","black","red","yellow","blue","green","pink","teal","aqua","lime","olive","gray","fuchsia","purple","navy","grey","maroon"];k("start").addEventListener("click",w,!1);k("stop").addEventListener("click",D,!1);k("reset").addEventListener("click",t,!1);k("clear").addEventListener("click",function(){t(!1)},!1);k("center").addEventListener("click",
function(){n=o=0},!1);k("setRule").addEventListener("click",function(){D();var a=document.getElementsByTagName("table")[0],b=a.rows.length-4,c=a.rows[3].cells.length-2;c%3!=0&&c--;c/=3;for(var d=[],e=0;e<b;e++){d[e]=[];for(var f=0;f<c;f++){d[e][f]=[];var g=e==0?2:1,h=a.rows[e+3].cells[f*3+g].innerHTML,i=a.rows[e+3].cells[f*3+g+1].innerHTML,g=a.rows[e+3].cells[f*3+g+2].innerHTML;if(h<c&&"LRAB".indexOf(i)!=-1&&g<b){d[e][f][0]=h;switch(i){case "L":d[e][f][1]=-1;break;case "R":d[e][f][1]=1;break;case "A":d[e][f][1]=
0;break;case "B":d[e][f][1]=-2}d[e][f][2]=g}else{console.log("Invalid rule");return}}}p=d;location.hash=JSON.stringify(p);t();w()},!1);k("randRule").addEventListener("click",function(){D();i=Math.ceil(Math.random()*4)+1;l=Math.ceil(Math.random()*5);p=[];for(var a=0;a<l;a++){p[a]=[];for(var b=0;b<i;b++)p[a][b]=[Math.floor(Math.random()*i),Math.floor(Math.random()*4)-2,Math.floor(Math.random()*l)]}G(p);location.hash=JSON.stringify(p);t(!1);w()},!1);k("next").addEventListener("click",z,!1);window.addEventListener("resize",
function(){var a=k("tutorial");A=a.width=window.innerWidth-30;B=a.height=window.innerHeight-70;q=Math.floor(a.width/h);r=Math.floor(a.height/h);o=Math.floor(j.y-r/2);n=Math.floor(j.x-q/2)},!1);k("options").addEventListener("mouseover",function(){this.style.height="auto"},!1);k("options").addEventListener("mouseout",function(){this.style.height="10px"},!1);t(!1);w();G(p)})();